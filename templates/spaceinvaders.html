<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Example</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@0.11.2"></script>
  <script type="module" src="../avichay/webcam.js"></script>
  <script type="module" src="../avichay/tf.js"></script>
</head>
<body>

  <script type="module">

      import webcamUtils from 'webcam.js';
      import LearningModel from 'tf.js';

      let model
      let canvas
      let video

      (async function () {

        const btn0 = document.getElementById('btn0')
        const btn1 = document.getElementById('btn1')
        const btnTrain = document.getElementById('train')
        const btnStart = document.getElementById('start')
        const btnPlayGame = document.getElementById('playGame')

        video = document.getElementById('webcam')
        await webcamUtils.init(document.getElementById('webcam'))
        canvas = webcamUtils.canvas
        model = new LearningModel(2)
        await model.initialize()

        document.body.appendChild(webcamUtils.canvas)
        document.getElementById('status').textContent = 'ready!'

        btn0.onclick = btn1.onclick = function buttonHandler () {
          webcamUtils.capture()
          const label = parseInt(this.id.slice(3))
          const imageData = model.captureImageFromCanvas(canvas)
          model.sample(imageData, label)
        }

        const done = (loss) => {
          console.log(loss)
        }

        btnTrain.onclick = function () {
          model.train(done)
        }

        btnStart.onclick = function () {
          detect()
          this.remove()
        }

        btnPlayGame.onclick = function () {
          playGame()
        }
    </style>
</head>
<body>
<div class="logo">
    <img class="main" src="../static/images/logo.png"/>
    <img class="logo-marker" src="../static/images/222.png"/>
</div>
<div class="webcam-container flex-row">
    <div class="controller-panels" id="controller">

        <div class="panel training-panel">

            <!-- Big buttons. -->
            <div class="panel-row big-buttons">
                <button id="train">
                    <img width="66" height="66" src="../static/images/button.png"/>
                    <span id="train-status">TRAIN/LOAD MODEL</span>
                </button>
                <button id="predict">
                    <img width="66" height="66" src="../static/images/button.png"/>
                    <span>PLAY</span>
                </button>
            </div><!-- /.panel-row -->

            <div class="panel-row params-webcam-row">
                <div id="paramsForm" style="display: none">
                    <label>Learning rate</label>
                    <select id="inpLearningRate">
                        <option value="0.00001">0.00001</option>
                        <option selected value="0.0001">0.0001</option>
                        <option value="0.001">0.001</option>
                        <option value="0.003">0.003</option>
                    </select>

                    <label>Batch size</label>
                    <select id="inpBatchSize">
                        <option value="0.05">0.05</option>
                        <option value="0.1">0.1</option>
                        <option selected value="0.4">0.4</option>
                        <option value="1">1</option>
                    </select>

                    <label>Epochs</label>
                    <select id="inpEpochs">
                        <option value="10">10</option>
                        <option selected value="20">20</option>
                        <option value="40">40</option>
                    </select>

                    <label>Hidden Units</label>
                    <select id="inpHiddenUnits">
                        <option value="10">10</option>
                        <option selected value="100">100</option>
                        <option value="200">200</option>
                    </select>

                    <label>Threshold: <span id="thresholdMonitor">95%</span></label>
                    <input type="range" mix="50" value="95" max="99" step="1" id="inferenceThreshold">
                </div>
                <div class="webcam-box-outer">
                    <div class="webcam-box-inner">
                        <video autoplay playsinline muted id="webcam" width="224" height="224"></video>
                    </div>
                </div>

            </div><!-- /.panel-row -->

        </div><!-- /.panel -->

        <div class="panel joystick-panel">

            <div class="panel-row panel-row-top">

                <div class="panel-cell panel-cell-left panel-cell-fill" style="width: 100%">
                    <span id="probabilityMonitor"></span>
                </div><!-- ./panel-cell -->

                <div class="panel-cell panel-cell-center">
                </div><!-- ./panel-cell -->

                <div class="panel-cell panel-cell-right panel-cell-fill">
                </div><!-- ./panel-cell -->

            </div><!-- /.panel-row -->

            <div class="panel-row panel-row-middle center-horiz">
                <div class="panel-cell panel-cell-left">
                    <div class="thumb-box">
                        <div class="thumb-box-outer">
                            <div class="thumb-box-inner">
                                <canvas class="thumb" width=224 height=224 id="left-thumb"></canvas>
                            </div>
                            <button class="record-button" id="left" value="4"><span>Add Sample</span></button>
                        </div>
                        <p>
                            <span id="left-total" class="total">0</span> examples
                        </p>
                    </div>
                </div><!-- ./panel-cell -->

                <div class="panel-cell panel-cell-right">
                    <div class="thumb-box">
                        <div class="thumb-box-outer">
                            <div class="thumb-box-inner">
                                <canvas class="thumb" width=224 height=224 id="right-thumb"></canvas>
                            </div>
                            <button class="record-button" id="right" value="6"><span>Add Sample</span></button>
                        </div>
                        <p>
                            <span id="right-total" class="total">0</span> examples
                        </p>
                    </div>
                </div><!-- ./panel-cell -->

            </div><!-- /.panel-row -->

            <div class="panel-row panel-row-bottom">

                <div class="panel-cell panel-cell-left panel-cell-fill">
                </div><!-- ./panel-cell -->

                <div class="panel-cell panel-cell-center">
                </div><!-- ./panel-cell -->

                <div class="panel-cell panel-cell-right panel-cell-fill">
                </div><!-- ./panel-cell -->

            </div><!-- /.panel-row -->


        </div><!-- /.panel -->

    </div>
</div>
<div id="game">
    <div class="pic-container">
        <div id="pic">
            PICTURE HERE
        </div>
    </div>
    <div id="score">
        SCORE HERE
    </div>
</div>
<script>
    var data = [
        {
            url: "https://steemitimages.com/0x0/https://2.bp.blogspot.com/-A8dl6_L7SW4/WYQbotGNZeI/AAAAAAAAP7Q/m0vYGtnBRUE2VJRstLltwz0OqCfR4unLgCLcBGAs/s1600/realbotix-1.png",
            bot: "bot"
        },
        {
            url: "http://i.dailymail.co.uk/i/pix/2017/04/03/18/3EE8224400000578-4376310-The_bizarre_doll_named_Harmony_2_0_talks_in_a_Scottish_accent_an-a-11_1491240496122.jpg",
            bot: "bot"
        },
        {
            url: "https://i.ytimg.com/vi/r35wXD4BvFY/maxresdefault.jpg",
            bot: "bot"
        },
        {
            url: "https://www.usmagazine.com/wp-content/uploads/alina-kovalevskaya-human-barbie-doll-d219f671-fd1d-406e-ad85-a714a4b7c3f1.jpg",
            bot: "not"
        },
        {
            url: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQmYjFBulcu1QxALeTltYKCMcz4bSDOqTHvC8j8hMBi_fZIXaUv",
            bot: "not"
        },
        {
            url: "https://media.gq.com/photos/5591b723838c214c3f48bf1f/3:2/w_880/human-barbie-doll-01.jpg",
            bot: "not"
        },
        {
            url: "http://d1nnx3nhddxmeh.cloudfront.net/wp-content/uploads/2017/10/17111510/HumanBarbie5.jpg",
            bot: "not"
        },
        {
            url: "https://ctd-thechristianpost.netdna-ssl.com/en/full/20600/alina-kovalevskaya.jpg?w=380&h=380",
            bot: "not"
        },
        {
            url: "https://pbs.twimg.com/profile_images/470180844930207744/Y1wrduJ-_400x400.jpeg",
            bot: "not"
        },
        {
            url: "http://www.dailymail.co.uk/cxresources/MTA3MjAxODh8Y3hvLmF8aHR0cDovL2kuZGFpbHltYWlsLmNvLnVrL2kvcGl4LzIwMTQvMDcvMDMvYXJ0aWNsZS0yNjc5NjMxLTFGNUQ4NzVDMDAwMDA1NzgtNzZfNjM0eDU1NS5qcGd8MTA3MjAxODhjeG8uYXxkYWlseTIwMTgwNjA0",
            bot: "not"
        },
        {
            url: "http://www.dailymail.co.uk/cxresources/MTA3MjAxODh8Y3hvLmN8aHR0cDovL2kuZGFpbHltYWlsLmNvLnVrL2kvcGl4LzIwMTQvMDcvMDMvYXJ0aWNsZS0yNjc5NjMxLTFGNUE0MEJCMDAwMDA1NzgtNTI0XzYzNHg0NTguanBnfGRhaWx5MjAxODA2MDQ=",
            bot: "not"
        },
        {
            url: "https://hips.hearstapps.com/cos.h-cdn.co/assets/15/22/1432826858-ht-facebook-alina-01.jpg?crop=1.0xw:1xh;center,top&resize=980:*",
            bot: "not"
        },
        {
            url: "https://hips.hearstapps.com/cos.h-cdn.co/assets/15/22/1432757456-newsdog-teenage-human-barbie28.jpg?resize=980:*",
            bot: "not"
        },
        {
            url: "http://www.dailymail.co.uk/cxresources/MTA3MjAxODl8Y3hvLmF8aHR0cDovL2kuZGFpbHltYWlsLmNvLnVrL2kvcGl4LzIwMTcvMTAvMjgvMjEvNDVDOEZCMDcwMDAwMDU3OC01MDI3NTczLWltYWdlLWEtNzRfMTUwOTIyMTM0NDU3OS5qcGd8ZGFpbHkyMDE4MDYwNA==",
            bot: "bot"
        },
        {
            url: "https://img.huffingtonpost.com/asset/58b8c81e1a00003400f415ca.jpeg?ops=crop_60_26_807_537,scalefit_720_noupscale",
            bot: "bot"
        },
        {
            url: "https://static.independent.co.uk/s3fs-public/thumbnails/image/2016/04/18/15/jia2.jpg?width=1368&height=912&fit=bounds&format=pjpg&auto=webp&quality=70",
            bot: "bot"
        },
        {
            url: "https://img.huffingtonpost.com/asset/577fdfe91a00002600dd0441.jpeg?ops=scalefit_960_noupscale",
            bot: "bot"
        },
        {
            url: "https://img.huffingtonpost.com/asset/577fdfea1a00002700dd0443.jpeg?ops=scalefit_960_noupscale",
            bot: "bot"
        },
        {
            url: "https://cdn.newsapi.com.au/image/v1/6ac50bc6e0c60ef32bc9c4ece1828bb2?width=316",
            bot: "not"
        },
        {
            url: "https://imagesvc.timeincapp.com/v3/mm/image?url=https%3A%2F%2Fpeopledotcom.files.wordpress.com%2F2016%2F08%2Frodrigo-alves-600.jpg%3Fw%3D600&w=700&q=85",
            bot: "not"
        },
        {
            url: "http://www.itjeher.com/wp-content/uploads/2018/03/5a98a9fdee64f-robot-seks-henry_663_382.jpg",
            bot: "bot"
        },
        {
            url: "http://beta.ems.ladbiblegroup.com/s3/content/84434e305a53640b40a130ff26ba78e3.png",
            bot: "bot"
        },
        {
            url: "https://ksassets.timeincuk.net/wp/uploads/sites/55/2018/07/Trump-920x584.jpg",
            bot: "bot"
        }
    ];
</script>

<script src='{{ url_for('static', filename='spaceinvaders/js/starfield.js') }}'></script>
<script src='{{ url_for('static', filename='spaceinvaders/js/spaceinvaders.js') }}'></script>
<script>
    //  Create the starfield.
    var container = document.getElementById('starfield');
    var starfield = new Starfield();
    starfield.initialise(container);
    starfield.start();

    //  Setup the canvas.
    var canvas = document.getElementById("gameCanvas");
    canvas.width = 850;
    canvas.height = 600 / 2;

    //  Create the game.
    var game = new Game();

      })()

      let x = 0

      async function detect () {
        webcamUtils.capture()
        const imageData = model.captureImageFromCanvas(canvas)
        const predictions = await model.test(imageData)
        console.log(predictions)
        x++
        detect()
      }

      async function playGame () {
        webcamUtils.capture()
        const imageData = model.captureImageFromCanvas(canvas)
        const predictions = await model.test(imageData)
        console.log(predictions)
        x++
        playGame()
      }

    </script>


  <video id="webcam" height="360" width="360" autoplay></video>

  <div id="status"></div>
  <button id="btn0">Sample as item #0</button>
  <button id="btn1">Sample as item #1</button>
  <button id="train">Train Model</button>
  <button id="start">Start detection</button>
  <button id="playGame">play game</button>

</body>
</html>
